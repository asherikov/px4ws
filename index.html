<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc-markdown-css-theme" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>px4ws</title>
  <link rel="stylesheet" href="theme.css" />
  <link rel="stylesheet" href="skylighting-solarized-theme.css" />
</head>
<body>

<header>
<h1 class="title">px4ws</h1>
<blockquote class="metadata">
<p class="date before-toc"><time datetime="DATE: 2025-10-26">DATE: 2025-10-26</time></p>
</blockquote>
</header>

<nav id="TOC" role="doc-toc">
    <strong>Contents</strong><label for="contents">⊕</label>
  <input type="checkbox" id="contents">
  <ul>
  <li><a href="#overview" id="toc-overview"><span class="toc-section-number">1</span> Overview</a>
  <ul>
  <li><a href="#packages" id="toc-packages"><span class="toc-section-number">1.1</span> Packages</a></li>
  </ul></li>
  <li><a href="#usage" id="toc-usage"><span class="toc-section-number">2</span> Usage</a>
  <ul>
  <li><a href="#building" id="toc-building"><span class="toc-section-number">2.1</span> Building</a></li>
  <li><a href="#binary-package" id="toc-binary-package"><span class="toc-section-number">2.2</span> Binary package</a></li>
  <li><a href="#running" id="toc-running"><span class="toc-section-number">2.3</span> Running</a></li>
  <li><a href="#cdinit-services" id="toc-cdinit-services"><span class="toc-section-number">2.4</span> cdinit services</a>
  <ul>
  <li><a href="#example" id="toc-example"><span class="toc-section-number">2.4.1</span> Example</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#troubleshooting" id="toc-troubleshooting"><span class="toc-section-number">3</span> Troubleshooting</a></li>
  <li><a href="#todo" id="toc-todo"><span class="toc-section-number">4</span> TODO</a></li>
  <li><a href="#packages-1" id="toc-packages-1"><span class="toc-section-number">5</span> Packages</a>
  <ul>
  <li><a href="#dependency-graph" id="toc-dependency-graph"><span class="toc-section-number">5.1</span> Dependency graph</a></li>
  <li><a href="#doxygen-documentation" id="toc-doxygen-documentation"><span class="toc-section-number">5.2</span> Doxygen documentation</a></li>
  <li><a href="#workspace-status" id="toc-workspace-status"><span class="toc-section-number">5.3</span> Workspace status</a></li>
  </ul></li>
  <li><a href="#useful-links" id="toc-useful-links"><span class="toc-section-number">6</span> Useful links</a>
  <ul>
  <li><a href="#ros1" id="toc-ros1"><span class="toc-section-number">6.1</span> ROS1</a></li>
  <li><a href="#ros2" id="toc-ros2"><span class="toc-section-number">6.2</span> ROS2</a></li>
  </ul></li>
  </ul>
</nav>

<main>
<h1 data-number="1" id="overview"><span class="header-section-number">1</span> Overview</h1>
<table>
<tr>
<td align="center">
CI status
</td>
<td align="center">
Debian package
</td>
</tr>
<tr>
<td align="center">
<a href="https://github.com/asherikov/px4ws/actions/workflows/main.yaml"> <img src="https://github.com/asherikov/px4ws/actions/workflows/main.yaml/badge.svg" alt="Build Status"> </a>
</td>
<td align="center">
<a href="https://cloudsmith.io/~asherikov-aV7/repos/all/packages/detail/deb/px4ws--reldebug--all/latest/a=amd64;d=ubuntu%252Fnoble;t=binary/"> <img src="https://api-prd.cloudsmith.io/v1/badges/version/asherikov-aV7/all/deb/px4ws--reldebug--all/latest/a=amd64;d=ubuntu%252Fnoble;t=binary/?render=true&show_latest=true" alt="Latest version of 'px4ws' @ Cloudsmith"> </a>
</td>
</tr>
</table>
<p>Multi-drone PX4 SITL setup using Gazebo and ROS2. Generally follows <a href="https://docs.px4.io/main/en/sim_gazebo_gz/" class="uri">https://docs.px4.io/main/en/sim_gazebo_gz/</a>, but uses custom bringup scripts which serve as a showcase of <a href="https://github.com/asherikov/cdinit" class="uri">https://github.com/asherikov/cdinit</a>.</p>
<p>Workspace documentation is at <a href="http://www.sherikov.net/px4ws/" class="uri">http://www.sherikov.net/px4ws/</a>.</p>
<h2 data-number="1.1" id="packages"><span class="header-section-number">1.1</span> Packages</h2>
<pre><code>PX4-Autopilot/PX4-Autopilot                         main             https://github.com/asherikov/PX4-Autopilot.git
cdinit                                              master           https://github.com/asherikov/cdinit.git
dds_agent/Micro-XRCE-DDS-Agent/Micro-XRCE-DDS-Agent v2.4.3           https://github.com/eProsima/Micro-XRCE-DDS-Agent.git
dds_agent/spdlog                                    v1.9.2           https://github.com/gabime/spdlog.git
px4_msgs                                            as_disable_tests https://github.com/asherikov/px4_msgs.git</code></pre>
<p><code>PX4-Autopilot</code> and <code>Micro-XRCE-DDS-Agent</code> are build using proxy packages in order to apply a few <code>cmake</code> tweaks</p>
<h1 data-number="2" id="usage"><span class="header-section-number">2</span> Usage</h1>
<h2 data-number="2.1" id="building"><span class="header-section-number">2.1</span> Building</h2>
<ul>
<li><p>Build <code>px4sitl</code> master package. Workspace is designed to be used with <a href="https://github.com/asherikov/ccws" class="uri">https://github.com/asherikov/ccws</a>, but basic <code>colcon</code> build should work too.</p></li>
<li><p>Dependencies can be installed with <code>rosdep</code> except a few PX4 python dependencies that are installed with cmake during build step.</p></li>
</ul>
<h2 data-number="2.2" id="binary-package"><span class="header-section-number">2.2</span> Binary package</h2>
<ul>
<li>Go to <code>cloudsmith</code> package repo, add new apt source, and run apt update.</li>
<li><code>sudo apt install px4ws--reldebug--all</code></li>
<li><code>source /opt/px4ws/px4ws__reldebug__all/setup.bash</code></li>
<li>Launch as explained below.</li>
</ul>
<h2 data-number="2.3" id="running"><span class="header-section-number">2.3</span> Running</h2>
<ul>
<li>Run <code>px4sitl.sh -w walls -d 4001 "0,1.0,0,0,0,0" -d 4004 "0,-5.0,0,0,0,0"</code> where <code>-w</code> specifies world (‘default’ if not set), <code>-d</code> specifies a drone model id and its location (x,y,z,r,p,y). Numerical ids can be found in a table at <a href="https://docs.px4.io/main/en/sim_gazebo_gz/" class="uri">https://docs.px4.io/main/en/sim_gazebo_gz/</a>.</li>
<li><code>px4sitl.sh</code> also supports headless mode, which is enabled by passing <code>-H</code> flag.</li>
<li>Terminate by closing Gazebo gui, or with <code>cdinit.sh shutdown</code>.</li>
</ul>
<h2 data-number="2.4" id="cdinit-services"><span class="header-section-number">2.4</span> cdinit services</h2>
<p>All components are started using <code>dinit</code> service files located in <code>px4sitl/cdinit_services/</code>, see <a href="https://github.com/davmac314/dinit" class="uri">https://github.com/davmac314/dinit</a>, <a href="https://github.com/asherikov/cdinit" class="uri">https://github.com/asherikov/cdinit</a> provides a cmake wrapper for <code>dinit</code> and helper scripts. Shell scripts are primarily used to setup environment and working directories.</p>
<h3 data-number="2.4.1" id="example"><span class="header-section-number">2.4.1</span> Example</h3>
<ul>
<li>Start <code>px4sitl.sh -w walls -d 4001 "0,1.0,0,0,0,0" -d 4004 "0,-5.0,0,0,0,0"</code></li>
<li>List services <code>cdinit.sh list | sort</code> to get something like</li>
</ul>
<pre><code># dummy &quot;boot&quot; service
[[+]     ] cdinit_main
# Gazebo gui
[[+]     ] px4sitl_gz_gui (pid: XXX)
# PX4 instances, number after @ symbol is a corresponding system id
[[+]     ] px4sitl_px4@0 (pid: XXX)
[[+]     ] px4sitl_px4@1 (pid: XXX)
# logging services, cdinit_log helper adds timestamps
[{+}     ] cdinit_log@px4sitl_dds_agent (pid: XXX)
[{+}     ] cdinit_log@px4sitl_gz_clock (pid: XXX)
[{+}     ] cdinit_log@px4sitl_gz_gui (pid: XXX)
[{+}     ] cdinit_log@px4sitl_gz_headless (pid: XXX)
[{+}     ] cdinit_log@px4sitl_gz_wait (pid: XXX)
[{+}     ] cdinit_log@px4sitl_px4@0 (pid: XXX)
[{+}     ] cdinit_log@px4sitl_px4@1 (pid: XXX)
# Micro-XRCE-DDS-Agent bridging PX4 and ros2
[{+}     ] px4sitl_dds_agent (pid: XXX)
# Gazebo -&gt; ROS2 simulation clock bridge
[{+}     ] px4sitl_gz_clock (pid: XXX)
# Gazebo simulation core
[{+}     ] px4sitl_gz_headless (pid: XXX)
# Helper service which waits for Gazebo to start
[{+}     ] px4sitl_gz_wait
# Dummy &quot;master&quot; service
[{+}     ] px4sitl_ros</code></pre>
<ul>
<li>Location of the log files depends on environment variables, e.g., <code>ROS_LOG_DIR</code> and is printed on startup.</li>
<li>Terminate using <code>cdinit.sh shutdown</code>. Since all processes are required, termination can also be performed by stopping a particular service, e.g., <code>cdinit.sh stop --force px4sitl_gz_clock</code>.</li>
</ul>
<h1 data-number="3" id="troubleshooting"><span class="header-section-number">3</span> Troubleshooting</h1>
<ul>
<li><code>protobuf</code> errors like the following could be caused by multiple Gazebo versions installed in parallel: <code>[libprotobuf ERROR   google/protobuf/descriptor_database.cc:121] File already exists in database:   gz/msgs/pointcloud.proto</code></li>
</ul>
<h1 data-number="4" id="todo"><span class="header-section-number">4</span> TODO</h1>
<ul>
<li><code>FindOpticalFlow.cmake</code> is installed in a wrong place.</li>
<li>Is installation of <code>px4/build/</code> intentional?</li>
<li><code>CMakeLists.txt</code>, <code>package.xml</code> should not be installed.</li>
<li>Is <code>spdlog</code> needed?</li>
</ul>
<h1 data-number="5" id="packages-1"><span class="header-section-number">5</span> Packages</h1>
<h2 data-number="5.1" id="dependency-graph"><span class="header-section-number">5.1</span> Dependency graph</h2>
<p><a href="pkg_dependency_graph.svg"><img src="pkg_dependency_graph.svg" /></a></p>
<h2 data-number="5.2" id="doxygen-documentation"><span class="header-section-number">5.2</span> Doxygen documentation</h2>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 36%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Package</strong></th>
<th style="text-align: center;">Dependencies</th>
<th style="text-align: center;">Dependents</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="./cdinit/index.html">cdinit</a></td>
<td style="text-align: center;"><a href="./cdinit/pkg_dependency_graph.svg">graph</a></td>
<td style="text-align: center;"><a href="./cdinit/pkg_reverse_dependency_graph.svg">graph</a></td>
</tr>
<tr class="even">
<td><a href="./cdinit_examples/index.html">cdinit_examples</a></td>
<td style="text-align: center;"><a href="./cdinit_examples/pkg_dependency_graph.svg">graph</a></td>
<td style="text-align: center;"><a href="./cdinit_examples/pkg_reverse_dependency_graph.svg">graph</a></td>
</tr>
<tr class="odd">
<td><a href="./cdinit_manager/index.html">cdinit_manager</a></td>
<td style="text-align: center;"><a href="./cdinit_manager/pkg_dependency_graph.svg">graph</a></td>
<td style="text-align: center;"><a href="./cdinit_manager/pkg_reverse_dependency_graph.svg">graph</a></td>
</tr>
<tr class="even">
<td><a href="./dds_agent/index.html">dds_agent</a></td>
<td style="text-align: center;"><a href="./dds_agent/pkg_dependency_graph.svg">graph</a></td>
<td style="text-align: center;"><a href="./dds_agent/pkg_reverse_dependency_graph.svg">graph</a></td>
</tr>
<tr class="odd">
<td><a href="./px4_msgs/index.html">px4_msgs</a></td>
<td style="text-align: center;"><a href="./px4_msgs/pkg_dependency_graph.svg">graph</a></td>
<td style="text-align: center;"><a href="./px4_msgs/pkg_reverse_dependency_graph.svg">graph</a></td>
</tr>
<tr class="even">
<td><a href="./px4sitl/index.html">px4sitl</a></td>
<td style="text-align: center;"><a href="./px4sitl/pkg_dependency_graph.svg">graph</a></td>
<td style="text-align: center;"><a href="./px4sitl/pkg_reverse_dependency_graph.svg">graph</a></td>
</tr>
<tr class="odd">
<td><a href="./spdlog/index.html">spdlog</a></td>
<td style="text-align: center;"><a href="./spdlog/pkg_dependency_graph.svg">graph</a></td>
<td style="text-align: center;"><a href="./spdlog/pkg_reverse_dependency_graph.svg">graph</a></td>
</tr>
</tbody>
</table>
<p>Total number of packages: 7</p>
<h2 data-number="5.3" id="workspace-status"><span class="header-section-number">5.3</span> Workspace status</h2>
<div class="wide">
<pre><code>tags/0.1.2-0-g3a947a9
WSH: &gt;&gt;&gt; status: git sources ---
Flags: H - version hash mismatch, M - uncommited changes
name                                                version          actual version                    HM repository
----                                                -------          --------------                    -- ----------
PX4-Autopilot/PX4-Autopilot                         main             heads/main-0-g2e586c4                https://github.com/asherikov/PX4-Autopilot.git
cdinit                                              master           heads/master-0-g3bb0858              https://github.com/asherikov/cdinit.git
dds_agent/Micro-XRCE-DDS-Agent/Micro-XRCE-DDS-Agent v2.4.3           tags/v2.4.3-0-g7362281               https://github.com/eProsima/Micro-XRCE-DDS-Agent.git
dds_agent/spdlog                                    v1.9.2           tags/v1.9.2-0-geb32206               https://github.com/gabime/spdlog.git
px4_msgs                                            as_disable_tests heads/as_disable_tests-0-g1398c8b    https://github.com/asherikov/px4_msgs.git

WSH:  &lt;&lt;&lt; status: git sources ---</code></pre>
</div>
<h1 data-number="6" id="useful-links"><span class="header-section-number">6</span> Useful links</h1>
<ul>
<li><a href="https://status.openrobotics.org/">ROS online status</a></li>
<li><a href="https://github.com/ros/rosdistro/blob/master/rosdep/base.yaml">ROSDEP packages</a></li>
</ul>
<h2 data-number="6.1" id="ros1"><span class="header-section-number">6.1</span> ROS1</h2>
<ul>
<li><a href="http://docs.ros.org/en/noetic/api/roscpp/html/">C++ API</a></li>
<li><a href="https://docs.ros.org/en/noetic/api/catkin/html/dev_guide/generated_cmake_api.html">catkin API</a></li>
</ul>
<h2 data-number="6.2" id="ros2"><span class="header-section-number">6.2</span> ROS2</h2>
<ul>
<li><a href="https://docs.ros2.org/latest/api/rclcpp/namespacerclcpp.html">C++ API</a></li>
<li><a href="https://docs.ros.org/en/foxy/How-To-Guides/Ament-CMake-Documentation.html">ament</a></li>
</ul>
</main>

<script>
;(function() {
  // Non-essential if user has JavaScript off. Just makes checkboxes look nicer.
  var selector = '.task-list > li > input[type="checkbox"]';
  var checkboxes = document.querySelectorAll(selector);
  Array.from(checkboxes).forEach((checkbox) => {
    var wasChecked = checkbox.checked;
    checkbox.disabled = false;
    checkbox.addEventListener('click', (ev) => {ev.target.checked = wasChecked});
  });
})();
</script>
</body>
</html>
