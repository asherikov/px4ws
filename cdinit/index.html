<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cdinit: Dinit</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">cdinit
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Dinit </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_dinit_2README"></a> v0.19.5pre</p>
<hr  />
 <h1><a class="anchor" id="autotoc_md2"></a>
&lt;img src="doc/dinit-logo.png" alt="Dinit logo"/&gt;</h1>
<p>This is the README for Dinit, the service manager and init system. It is intended to provide an overview; For full documentation please check the manual pages. The impatient may wish to check out the getting started guide.</p>
<p>Dinit is used as the init system for <a href="https://chimera-linux.org/">Chimera Linux</a>, and is an init system option for <a href="https://artixlinux.org/">Artix Linux</a>.</p>
<hr  />
<p><em>Dinit is free software. You may wish to consider <a href="https://github.com/sponsors/davmac314">sponsoring Dinit's development</a></em>.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md5"></a>
Contents</h1>
<ol type="1">
<li>Introduction<ol type="a">
<li>Features</li>
<li>Target platforms</li>
<li>Other information</li>
</ol>
</li>
<li>Reporting issues</li>
<li>Configuring services<ol type="a">
<li>Service types</li>
<li>Service description files</li>
</ol>
</li>
<li>Running Dinit</li>
<li>Controlling services<ol type="a">
<li>Service hierarchy and states</li>
<li>Using dinitctl</li>
</ol>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md6"></a>
Introduction</h1>
<p><em>Dinit</em> is a service supervisor with dependency support which can also act as the system "init" program. It was created with the intention of providing a portable init system with dependency management, that was functionally superior to many extant inits. Development goals include clean design, robustness, portability, usability, and avoiding feature bloat (whilst still handling common - and some less-common - use cases). Dinit is designed to <em>integrate with</em> rather than subsume or replace other system software.</p>
<h2>Features</h2>
<p>Dinit can launch multiple services in parallel, with dependency management (i.e. if one service's operation depends on another, the latter service will be started first). It can monitor the process corresponding to a service, and re-start it if it dies, and it can do this in an intelligent way - first "rolling back" all dependent services, and restarting them when their dependencies are satisfied. The <em>dinitctl</em> tool can be used to start or stop services and check their state.</p>
<p>Dinit is designed to run as either as a system service manager (runs as root, uses system paths for configuration) or a user process (runs as a user, uses paths in the user's home directory for configuration).</p>
<h2>Target platforms</h2>
<p>Dinit is designed to work on POSIXy operating systems such as Linux and OpenBSD. It is written in C++ and uses the <a href="https://davmac.org/projects/dasynq/">Dasynq</a> event handling library, which was written especially to support Dinit. (Note that a copy of Dasynq is bundled with Dinit, so a separate copy is not required for compilation; however, the bundled copy does not include the documentation or test suite).</p>
<h2>Other information</h2>
<p>See <a href="doc/COMPARISON">doc/COMPARISON</a> for a comparison of Dinit with similar software packages.</p>
<p>Dinit is licensed under the Apache License, version 2.0. A copy of this license can be found in the [LICENSE](LICENSE) file.</p>
<p>This software was written by Davin McCall <a href="#" onclick="location.href='mai'+'lto:'+'dav'+'ma'+'c@d'+'av'+'mac'+'.o'+'rg'; return false;">davma<span class="obfuscator">.nosp@m.</span>c@da<span class="obfuscator">.nosp@m.</span>vmac.<span class="obfuscator">.nosp@m.</span>org</a> with contributions from many others. See [CONTRIBUTORS](CONTRIBUTORS).</p>
<p>See [BUILD](BUILD) for information on how to build Dinit. See the [doc](doc) directory for information on design, code style, guidelines for contributions, and end-user-oriented documentation.</p>
<p>Full documentation for Dinit is available in the form of manual (man) pages:</p><ul>
<li><a href="https://davmac.org/projects/dinit/man-pages-html/dinit.8.html">dinit(8)</a> - the <em>dinit</em> daemon</li>
<li><a href="https://davmac.org/projects/dinit/man-pages-html/dinit-service.5.html">dinit-service(5)</a> - service description format and service settings</li>
<li><a href="https://davmac.org/projects/dinit/man-pages-html/dinitctl.8.html">dinitctl(8)</a> - <em>dinitctl</em>, a utility to control the dinit daemon and manage services</li>
<li><a href="https://davmac.org/projects/dinit/man-pages-html/dinitcheck.8.html">dinitcheck(8)</a> - <em>dinitcheck</em>, a utility to check service descriptions for errors/lint</li>
<li><a href="https://davmac.org/projects/dinit/man-pages-html/dinit-monitor.8.html">dinit-monitor(8)</a> - <em>dinit-monitor</em>, a utility to monitor a service and run a command when service state changes</li>
</ul>
<p>A brief guide to some basic usage is included in the latter part of this README.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Reporting issues</h1>
<p>Please use <a href="https://github.com/davmac314/dinit/issues">Github issues</a> to report bugs, and provide as much information as is necessary to reliably reproduce the issue.</p>
<p>Please do not file feature requests unless you are working on system integration (eg. you are a package maintainer for a distribution that supports Dinit, or you are working to provide Dinit support for a particular distribution) and need to solve a real problem, or unless you are willing to provide patches (in this case you can open an issue for discussion - in which case please also see the <a href="doc/CONTRIBUTING">CONTRIBUTING</a> file).</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Configuring services</h1>
<p>This section and the following sections are intended as an introductory guide, and to give a feel for what using Dinit is like. For a complete reference, see the <em>man</em> pages: <a href="https://davmac.org/projects/dinit/man-pages-html/dinit.8.html">dinit(8)</a> and <a href="https://davmac.org/projects/dinit/man-pages-html/dinit-service.5.html">dinit-service(5)</a>.</p>
<h2>Service types</h2>
<p>A "service" is nominally a persistent process or system state. The two main types of service are a <em>process</em> service (represented by a an actual process) and a <em>scripted</em> service (which is started and stopped by running a process - often a shell script - to completion). There are also <em>bgprocess</em> services (for processes which put themselves "in the background" by forking), <em>internal</em> services (useful for grouping other processes or acting as checkpoints), and <em>triggered</em> services (which require an external event or trigger to start). See the <a href="https://davmac.org/projects/dinit/man-pages-html/dinit-service.5.html">dinit-service(5)</a> manual page for details.</p>
<p>Many programs that you might want to run under Dinit's supervision can run either "in the foreground" or as a daemon ("in the background"), and the choice is dictated by a command line switch (for instance the -D and -F switches to Samba's "smbd"). Although it might seem counterintuitive, the "foreground" mode should be used for programs registered as process services in Dinit; this allows Dinit to monitor the process.</p>
<h2>Service description files</h2>
<p>Dinit discovers services by reading <em>service description files</em>. These files reside in a directory (<code>/etc/dinit.d</code> is the default "system" location, with <code>/usr/local/lib/dinit.d</code> and <code>/lib/dinit.d</code> also searched; the default user location is <code>$HOME/.config/dinit.d</code>) and the name of a service description file matches the name of the service it configures.</p>
<p>For example, a service named "mysql" might be configured via the service description file named <code>/etc/dinit.d/mysql</code>. Service descriptions are loaded lazily, as needed by Dinit; so, this service description file will usually be read when the mysql service is first started.</p>
<p>(An example of a complete set of system service descriptions can be found in the <a href="doc/linux/services">doc/linux/services</a> directory).</p>
<p>A service description file has a textual format and consists of a number of parameter settings. Some examples of the available parameters are: </p><pre class="fragment">type = process | bgprocess | scripted | internal | triggered
command = ...
stop-command = ...
run-as = (user-id)
restart = (boolean)
logfile = ...
pid-file = ...
options: ...
depends-on: (service name)
depends-ms: (service name)
waits-for: (service name)
</pre><p> Typically, a service which runs as a process will use the <code>command</code> setting, and include a <code>waits-for</code> dependency on a number of other services (to ensure that the system is ready for general operation). For example, a service description for <code>sshd</code> might look like the following: </p><pre class="fragment">type = process
command = /usr/sbin/sshd -D
waits-for: syslogd
depends-on: loginready
</pre><p> In this example, <code>syslogd</code> and <code>loginready</code> are also services (which must have their own service descriptions).</p>
<p>A wide range of service settings and options are available. Please see the <a href="https://davmac.org/projects/dinit/man-pages-html/dinit-service.5.html">manual page</a> for a full list.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Running Dinit</h1>
<p>The main Dinit executable is called <code>dinit</code>.</p>
<p>Dinit can run as the system "init" - the first process started by the kernel on boot - which is normally done by linking or copying <code>dinit</code> to <code>/sbin/init</code>. This is currently supported only on Linux. It requires having suitable service descriptions in place and should be attempted only by those comfortable with low-level system administration and recovery. See <a href="doc/linux">doc/linux</a> directory for more information.</p>
<p>Dinit can also run as a normal process, and can be started in this case by a regular user.</p>
<p>By default, regardless of whether it runs as a system or user process, Dinit will look for and start the service named "boot". This service should be configured with dependencies which will cause any other desired services to start. You can specify alternative services to start via the <code>dinit</code> command line (consult the <a href="https://davmac.org/projects/dinit/man-pages-html/dinit.8.html">manual page</a> for more information).</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Controlling services</h1>
<h2>Service hierarchy and states</h2>
<p>Services can depend on other services for operation, and so form a dependency hierarchy. Starting a service which depends on another causes that other service to start (and the first service waits until the latter has started before its process is launched and it is itself considered started).</p>
<p>Services are considered <em>active</em> when they are not stopped. Services can also be explicitly marked as active (this normally happens when you explicitly start a service). Finally, a service with an active dependent is also considered active.</p>
<p>If a service stops and becomes inactive (i.e. it is not explicitly marked active and has no active dependents) then any services it depends on will also be stopped (becoming inactive) unless they have other active dependents, or they were explicitly started and marked active.</p>
<p>What this means is that, in general, starting an (inactive, stopped) service and then stopping it will return the system to its prior state - no dependencies which were started automatically will be left running.</p>
<h2>Using dinitctl</h2>
<p>You can use the "dinitctl" utility to start and stop services. Typical invocations are: </p><pre class="fragment">dinitctl start &lt;service-name&gt;
dinitctl stop &lt;service-name&gt;
dinitctl release &lt;service-name&gt;
dinitctl status &lt;service-name&gt;
dinitctl list
</pre><p> Note that a <em>start</em> marks the service active, as well as starting it if it is not already started; the opposite of this is actually <em>release</em>, which clears the active mark and stops it if it has no active dependent services.</p>
<p>The <em>stop</em> command by default acts as a release that also causes the service to stop. If stopping a service would also require a dependent service to stop, a warning will be issued; the <code>--force</code> option will be required to bypass the warning, though it is generally advisable to stop the dependent systems manually one-by-one - indirectly force-stopping the boot service may cause every service to stop, ending user sessions!</p>
<p>When run as root, dinitctl (by default) communicates with the system instance of dinit. Otherwise, it communicates with a user (personal) instance. This can be overridden (using <code>-u</code> or <code>-s</code> for the user or system instance, respectively), but note that regular users will generally lack the required permission to communicate with the system instance, which is intended to be controlled only by the root user.</p>
<p>Here is an example command for starting a service: </p><pre class="fragment">dinitctl start mysql   # start mysql service
</pre><p> You can "pin" a service in either the stopped or started state, which prevents it from changing state either due to a dependency/dependent or a direct command: </p><pre class="fragment">dinitctl start --pin mysql  # start mysql service, pin it as "started"
dinitctl stop mysql  # removes activation, service doesn't stop due to pin
dinitctl unpin mysql # release pin; service will now stop
</pre><p> You can pin a service in the stopped state in order to make sure it doesn't get started accidentally (either via a dependency or directly) when you are performing administration or maintenance.</p>
<p>Check the state of an individual service using the "status" subcommand: </p><pre class="fragment">dinitctl status mysql
</pre><p> The output will tell you the current service state; for a running service, it may look something like the following: </p><pre class="fragment">Service: mysql
    State: STARTED
    Activation: explicitly started
    Process ID: 3393
</pre><p> Finally, you can list the state of all loaded services: </p><pre class="fragment">dinitctl list
</pre><p> This may result in something like the following: </p><pre class="fragment">[[+]     ] boot
[{+}     ] tty1 (pid: 300)
[{+}     ] tty2 (pid: 301)
[{+}     ] tty3 (pid: 302)
[{+}     ] tty4 (pid: 303)
[{+}     ] loginready (has console)
[{+}     ] rcboot
[{+}     ] filesystems
[{+}     ] udevd (pid: 4)
[     {-}] mysql
</pre><p> The above represents a number of started services and one stopped service (mysql). Only the boot service is marked active (<code>[+]</code> rather than <code>{+}</code>); all other services are running only because they are (directly or indirectly) dependencies of boot. Services transitioning state (starting or stopping) are displayed with an arrow indicating the transition direction: </p><pre class="fragment">[[ ]&lt;&lt;   ] mysql     # starting (and marked active)
[   &gt;&gt;{ }] mysql     # stopping
</pre><p> The brackets indicate the target state, which may not be the state to which the service is currently transitioning. For example: </p><pre class="fragment">[   &lt;&lt;{ }] mysql     # starting, but will stop after starting
[{ }&gt;&gt;   ] mysql     # stopping, but will restart once stopped
</pre><p> Remember that a <em>starting</em> service may be waiting for its dependencies to start, and a <em>stopping</em> service may be waiting for its dependencies to stop.</p>
<p>For a complete summary of <code>dinitctl</code> command line options, use: </p><pre class="fragment">dinitctl --help
</pre><p> Or, for more detailed help, check the <a href="https://davmac.org/projects/dinit/man-pages-html/dinitctl.8.html">manual page for dinitctl</a>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
